@model PizzeriaOnline.ViewModels.CarritoViewModel
@{
    ViewData["Title"] = "Tu Carrito de Compras";
}

<h1>@ViewData["Title"]</h1>

@if (!Model.Pizzas.Any() && !Model.Extras.Any())
{
    <div class="alert alert-info">Tu carrito está vacío. <a asp-action="Index" class="alert-link">Vuelve al menú</a>.</div>
}
else
{
    <table class="table align-middle">
        <thead class="table-dark">
            <tr>
                <th>Producto</th>
                <th class="text-center">Cantidad</th>
                <th class="text-end">Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Pizzas)
            {
                <tr>
                    <td>
                        <h5 class="mb-1">@item.NombreTamaño</h5>
                        <ul class="list-unstyled mb-0 ps-3">
                            @foreach (var sabor in item.NombresSabores)
                            {
                                <li><small>- @sabor</small></li>
                            }
                        </ul>
                    </td>
                    <td class="text-center">@item.Cantidad</td>
                    <td class="text-end">@item.PrecioFinal.ToString("C")</td>
                    <td class="text-end">
                        <form asp-action="QuitarPizza" method="post">
                            <input type="hidden" name="id" value="@item.Id" />
                            <button type="submit" class="btn btn-danger btn-sm">Quitar</button>
                        </form>
                    </td>
                </tr>
            }
            @foreach (var extra in Model.Extras)
            {
                <tr>
                    <td>@extra.Nombre</td>
                    <td class="text-center">@extra.Cantidad</td>
                    <td class="text-end">@extra.Subtotal.ToString("C")</td>
                    <td class="text-end">
                        <form asp-action="QuitarExtra" method="post">
                            <input type="hidden" name="productoExtraId" value="@extra.ProductoExtraId" />
                            <button type="submit" class="btn btn-danger btn-sm">Quitar</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr class="table-light">
                <td colspan="2" class="text-end fs-5"><strong>Total:</strong></td>
                <td class="text-end fs-4"><strong>@Model.TotalGeneral.ToString("C")</strong></td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <div class="mt-4">
        <a asp-controller="Home" asp-action="Checkout" class="btn btn-success btn-lg @(!(bool)ViewData["EstaAbierta"] ? "disabled" : "")">Proceder al Pago</a>
        <a asp-controller="Home" asp-action="Constructor" class="btn btn-secondary btn-lg">Añadir otra Pizza</a>
    </div>

    @* --- AÑADIR EXTRAS (CÓDIGO CORREGIDO) --- *@
    <h4 class="mt-4">¿Deseas añadir algo más?</h4>
    <div class="row">
        @foreach (var extra in Model.ExtrasDisponibles)
        {
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <img src="@extra.RutaImagen" class="card-img-top" alt="@extra.Nombre" style="object-position: center top;" />
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@extra.Nombre</h5>
                        <p class="card-text fw-bold text-success">@extra.Precio.ToString("C")</p>

                        <div class="mt-auto">
                            <form asp-action="AgregarExtra" method="post">
                                <button type="submit" class="btn btn-info w-100"
                                        name="productoExtraId" value="@extra.Id">
                                    Añadir
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    
}